{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Step2 Prices Output Schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "generated_at_utc", "timeframe", "theme", "rows"],
  "properties": {
    "schema_version": { "type": "string" },
    "generated_at_utc": { "type": "string", "format": "date-time" },
    "timeframe": { "type": "string", "enum": ["1D", "4H", "1H", "30m", "15m", "5m", "1m"] },
    "theme": { "type": "string" },
    "source": { "type": "string" },
    "notes": { "type": "string" },
    "rows": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/PriceRow" }
    }
  },
  "$defs": {
    "PriceRow": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "date",
        "symbol",
        "theme",
        "timeframe",
        "status"
      ],
      "properties": {
        "date": { "type": "string", "format": "date" },
        "symbol": {
          "type": "string",
          "minLength": 1,
          "maxLength": 15,
          "pattern": "^[A-Z0-9][A-Z0-9.\\-]{0,14}$"
        },
        "theme": { "type": "string" },
        "timeframe": { "type": "string" },
        "open": { "type": "number" },
        "high": { "type": "number" },
        "low": { "type": "number" },
        "close": { "type": "number" },
        "volume": { "type": "number" },
        "status": { "type": "string", "enum": ["ok", "missing", "error"] },
        "error_reason": { "type": "string" }
      }
    }
  }
}
